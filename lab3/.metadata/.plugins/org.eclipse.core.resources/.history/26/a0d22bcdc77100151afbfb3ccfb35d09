/*
 * swich.cc
 *
 *  Created on: Oct 13, 2015
 *      Author: parallels
 */

#include "swich.h"
#include <iostream>
#include <fstream>
#include <string>
using namespace std;
using basic_protocol::basic_status;

sw::sw(sc_module_name module_name, int k, int i) : //constructor
		sc_module(module_name), target_port("iport"), initiator_port("iport"), i(
				i) {
	target_port(*this);
	memory = new ADDRESS_TYPE[k * 1024];
	SC_THREAD(run);
}

basic_status sw::write(const ADDRESS_TYPE &a, const DATA_TYPE &d) {
	count_receive++;
	cout << name() << " Memory " << i << ":writing at " << a << " value " << d
			<< endl;
	memory[a] = d;
	return basic_protocol::SUCCESS;
}

basic_status sw::read(const ADDRESS_TYPE &a, DATA_TYPE &d) {
	//count_read++;
	d = memory[a];
	cout << name() << " Memory " << i << ":reading at " << a << " value " << d
			<< endl;
	return basic_protocol::SUCCESS;
}

sw::~sw() {

	delete[] memory;
	cout << "The Node " << i << " count_receive is :" << count_receive
			<< endl;
	cout << "The Node " << i << " count_transmit is :" << count_transmit
			<< endl;
}





